<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebPing Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/ua-parser-simple.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header with User Menu -->
        <header class="dashboard-header">
            <div class="header-title">
                <span class="material-symbols-outlined">notifications_active</span>
                <h1>WebPing</h1>
            </div>
            <div class="user-menu">
                <button class="user-menu-btn" onclick="toggleUserMenu()">
                    <span class="material-symbols-outlined">account_circle</span>
                    <span id="username-display"></span>
                    <span class="material-symbols-outlined">expand_more</span>
                </button>
                <div id="user-dropdown" class="user-dropdown hidden">
                    <div class="user-dropdown-item" onclick="showChangePassword()">
                        <span class="material-symbols-outlined">lock</span>
                        Change Password
                    </div>
                    <div class="user-dropdown-item" onclick="logout()">
                        <span class="material-symbols-outlined">logout</span>
                        Logout
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('dashboard', event)">
                <span class="material-symbols-outlined">dashboard</span>
                Dashboard
            </button>
            <button class="tab-btn" onclick="switchTab('topics', event)">
                <span class="material-symbols-outlined">topic</span>
                Topics
            </button>
            <button class="tab-btn" onclick="switchTab('subscriptions', event)">
                <span class="material-symbols-outlined">devices</span>
                Subscriptions
            </button>
        </nav>

        <!-- Alert Container -->
        <div id="alert-container"></div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <section class="welcome-section">
                <h2>
                    <span class="material-symbols-outlined">waving_hand</span>
                    Welcome back!
                </h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="material-symbols-outlined">topic</span>
                        <div class="stat-value" id="topic-count">0</div>
                        <div class="stat-label">Topics</div>
                    </div>
                    <div class="stat-card">
                        <span class="material-symbols-outlined">devices</span>
                        <div class="stat-value" id="device-count">0</div>
                        <div class="stat-label">Devices</div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Topics Tab -->
        <div id="topics-tab" class="tab-content">
            <section class="create-topic-section">
                <form onsubmit="handleCreateTopic(event)" class="inline-form">
                    <input 
                        type="text" 
                        id="topic-name" 
                        placeholder="New topic name (e.g., buildFinished)"
                        required
                        pattern="[a-zA-Z0-9_-]+"
                        title="Only letters, numbers, hyphens and underscores allowed"
                    >
                    <button type="submit">
                        <span class="material-symbols-outlined">add</span>
                        Create Topic
                    </button>
                </form>
            </section>

            <section class="topics-list">
                <div id="topics-loading" class="loading">
                    <span class="material-symbols-outlined rotating">progress_activity</span>
                    Loading...
                </div>
                <div id="topics-container"></div>
            </section>
        </div>

        <!-- Subscriptions Tab -->
        <div id="subscriptions-tab" class="tab-content">
            <!-- Browser Support Check -->
            <div id="browser-check" class="alert alert-info">
                <span class="material-symbols-outlined">info</span>
                Checking browser support...
            </div>

            <!-- Register Push Section -->
            <section id="register-section" class="hidden">
                <form onsubmit="handleRegisterPush(event)" class="inline-form">
                    <input 
                        type="text" 
                        id="device-name" 
                        placeholder="Device name (e.g., My Laptop Chrome)"
                        required
                    >
                    <button type="submit" id="register-btn">
                        <span class="material-symbols-outlined">add_circle</span>
                        Register Browser
                    </button>
                </form>
            </section>

            <!-- Registered Endpoints Section -->
            <section class="endpoints-list">
                <div id="endpoints-loading" class="loading">
                    <span class="material-symbols-outlined rotating">progress_activity</span>
                    Loading...
                </div>
                <div id="endpoints-container"></div>
            </section>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="change-password-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Change Password</h2>
                <button class="modal-close" onclick="closeChangePassword()">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <form onsubmit="handleChangePassword(event)">
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="new-password" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="confirm-password" required minlength="6">
                </div>
                <div class="modal-actions">
                    <button type="button" class="secondary" onclick="closeChangePassword()">Cancel</button>
                    <button type="submit">Change Password</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/dashboard.js"></script>
</body>
</html>
